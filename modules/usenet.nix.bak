{ config, pkgs, ... }: {
  users.groups.usenet = {};
  users.users.usenet = {
    isSystemUser = true;
    createHome = true;
    group = "usenet";
  };
  system.activationScripts.usenet.text = ''
    mkdir -p /home/usenet/config/{nzbget,sonarr,radarr,jellyfin}
    mkdir -p /home/usenet/downloads
    echo PUID=$(id -u usenet) > /home/usenet/.env
    echo PGID=$(id -g usenet) >> /home/usenet/.env
    chown -R usenet:usenet /home/usenet
  '';
  networking.firewall.allowedTCPPorts = [ 6789 7878 8096 8989 ];
  virtualisation.podman = {
    enable = true;
    dockerCompat = true;
  };
  virtualisation.oci-containers = {
    backend = "podman";
    containers = {
      nzbget = {
        image = "lscr.io/linuxserver/nzbget:latest";
        ports = [ "6789:6789" ];
        volumes = [
          "/home/usenet/config/nzbget:/config"
          "/home/usenet/downloads:/downloads"
        ];
        environment = {
          TZ = "America/New_York";
        };
        environmentFiles = [ /home/usenet/.env ];
      };
      sonarr = {
        image = "lscr.io/linuxserver/sonarr:latest";
        ports = [ "8989:8989" ];
        volumes = [
          "/home/usenet/config/sonarr:/config"
          "/home/usenet/downloads:/downloads"
          "/data/tv:/tv"
        ];
        environment = {
          TZ = "America/New_York";
        };
        environmentFiles = [ /home/usenet/.env ];
      };
      radarr = {
        image = "lscr.io/linuxserver/radarr:latest";
        ports = [ "7878:7878" ];
        volumes = [
          "/home/usenet/config/radarr:/config"
          "/home/usenet/downloads:/downloads"
          "/data/movies:/movies"
        ];
        environment = {
          TZ = "America/New_York";
        };
        environmentFiles = [ /home/usenet/.env ];
      };
      jellyfin = {
        image = "lscr.io/linuxserver/jellyfin:latest";
        ports = [ "8096:8096" ];
        volumes = [
          "/home/usenet/config/jellyfin:/config"
          "/data:/data"
        ];
        environment = {
          TZ = "America/New_York";
        };
        environmentFiles = [ /home/usenet/.env ];
      };
    };
  };
}
